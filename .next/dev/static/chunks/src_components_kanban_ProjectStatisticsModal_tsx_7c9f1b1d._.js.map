{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/rubenoroz/scena-v1/src/components/kanban/ProjectStatisticsModal.tsx"],"sourcesContent":["import React, { useState } from 'react';\nimport { PieChart, Pie, Cell, ResponsiveContainer, Tooltip, Legend, BarChart, Bar, XAxis, YAxis, CartesianGrid } from 'recharts';\nimport { X, List, CheckCircle2, BarChart3 } from 'lucide-react';\n\ninterface ProjectStatisticsModalProps {\n    isOpen: boolean;\n    onClose: () => void;\n    tasks: any[];\n    columns?: any[];\n}\n\nconst COLORS = {\n    completed: '#22c55e', // green-500\n    inProgress: '#3b82f6', // blue-500\n    notStarted: '#94a3b8', // slate-400\n};\n\nexport function ProjectStatisticsModal({ isOpen, onClose, tasks, columns = [] }: ProjectStatisticsModalProps) {\n    const [viewMode, setViewMode] = useState<'status' | 'list_distribution' | 'list_performance'>('status');\n\n    if (!isOpen) return null;\n\n    // Filter for subtasks (tasks that have a parentId)\n    const subtasks = tasks.filter(task => task.parentId);\n    const totalSubtasks = subtasks.length;\n\n    if (totalSubtasks === 0) {\n        return (\n            <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm\" onClick={onClose}>\n                <div className=\"bg-white rounded-xl shadow-xl w-full max-w-md p-6 relative animate-in fade-in zoom-in duration-200\" onClick={e => e.stopPropagation()}>\n                    <button\n                        onClick={onClose}\n                        className=\"absolute top-4 right-4 text-gray-400 hover:text-gray-600 transition-colors\"\n                    >\n                        <X size={20} />\n                    </button>\n                    <h2 className=\"text-xl font-bold text-gray-800 mb-4\">Estadísticas del Proyecto</h2>\n                    <p className=\"text-gray-500 text-center py-8\">No hay subtareas para analizar aún.</p>\n                </div>\n            </div>\n        );\n    }\n\n    // --- Data Preparation ---\n\n    // 1. By Status\n    const completed = subtasks.filter(t => (t.progress || 0) === 100).length;\n    const notStarted = subtasks.filter(t => (t.progress || 0) === 0).length;\n    const inProgress = totalSubtasks - completed - notStarted;\n\n    const dataByStatus = [\n        { name: 'Completadas', value: completed, color: COLORS.completed },\n        { name: 'En Progreso', value: inProgress, color: COLORS.inProgress },\n        { name: 'Sin Iniciar', value: notStarted, color: COLORS.notStarted },\n    ].filter(item => item.value > 0);\n\n    // 2. By List (Column) - Distribution & Performance\n    const dataByList = columns.map(col => {\n        const tasksInCol = subtasks.filter(t => t.columnId === col.id);\n        const count = tasksInCol.length;\n\n        // Calculate average progress\n        const totalProgress = tasksInCol.reduce((sum, t) => sum + (t.progress || 0), 0);\n        const avgProgress = count > 0 ? Math.round(totalProgress / count) : 0;\n\n        return {\n            name: col.name,\n            value: count, // For Pie Chart\n            avgProgress: avgProgress, // For Bar Chart\n            color: col.color || '#cbd5e1',\n            taskCount: count\n        };\n    }).filter(item => viewMode === 'list_performance' ? true : item.value > 0); // Keep all columns for bar chart, filter empty for pie\n\n    const activeData = viewMode === 'status' ? dataByStatus : dataByList;\n\n    return (\n        <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm\" onClick={onClose}>\n            <div\n                className=\"bg-white rounded-xl shadow-xl w-full max-w-3xl p-6 relative animate-in fade-in zoom-in duration-200\"\n                onClick={e => e.stopPropagation()}\n            >\n                <button\n                    onClick={onClose}\n                    className=\"absolute top-4 right-4 text-gray-400 hover:text-gray-600 transition-colors\"\n                >\n                    <X size={20} />\n                </button>\n\n                <div className=\"flex flex-col md:flex-row items-start md:items-center justify-between mb-6 pr-8 gap-4\">\n                    <h2 className=\"text-xl font-bold text-gray-800\">Progreso de Subtareas</h2>\n\n                    {/* View Toggle */}\n                    <div className=\"flex bg-gray-100 p-1 rounded-lg overflow-x-auto max-w-full\">\n                        <button\n                            onClick={() => setViewMode('status')}\n                            className={`px-3 py-1.5 rounded-md text-xs sm:text-sm font-medium transition-all flex items-center gap-2 whitespace-nowrap ${viewMode === 'status'\n                                ? 'bg-white text-blue-600 shadow-sm'\n                                : 'text-gray-500 hover:text-gray-700'\n                                }`}\n                        >\n                            <CheckCircle2 size={16} />\n                            Por Estado\n                        </button>\n                        <button\n                            onClick={() => setViewMode('list_distribution')}\n                            className={`px-3 py-1.5 rounded-md text-xs sm:text-sm font-medium transition-all flex items-center gap-2 whitespace-nowrap ${viewMode === 'list_distribution'\n                                ? 'bg-white text-blue-600 shadow-sm'\n                                : 'text-gray-500 hover:text-gray-700'\n                                }`}\n                        >\n                            <List size={16} />\n                            Por Lista\n                        </button>\n                        <button\n                            onClick={() => setViewMode('list_performance')}\n                            className={`px-3 py-1.5 rounded-md text-xs sm:text-sm font-medium transition-all flex items-center gap-2 whitespace-nowrap ${viewMode === 'list_performance'\n                                ? 'bg-white text-blue-600 shadow-sm'\n                                : 'text-gray-500 hover:text-gray-700'\n                                }`}\n                        >\n                            <BarChart3 size={16} />\n                            Rendimiento\n                        </button>\n                    </div>\n                </div>\n\n                <div className=\"flex flex-col md:flex-row items-center gap-8\">\n                    {/* Chart Area */}\n                    <div className=\"w-full md:w-3/5 h-72\">\n                        <ResponsiveContainer width=\"100%\" height=\"100%\">\n                            {viewMode === 'list_performance' ? (\n                                <BarChart data={activeData} layout=\"vertical\" margin={{ left: 20, right: 20 }}>\n                                    <CartesianGrid strokeDasharray=\"3 3\" horizontal={false} />\n                                    <XAxis type=\"number\" domain={[0, 100]} unit=\"%\" />\n                                    <YAxis dataKey=\"name\" type=\"category\" width={100} tick={{ fontSize: 12 }} />\n                                    <Tooltip\n                                        formatter={(value: number) => [`${value}%`, 'Avance Promedio']}\n                                        contentStyle={{ borderRadius: '8px', border: 'none', boxShadow: '0 4px 6px -1px rgb(0 0 0 / 0.1)' }}\n                                    />\n                                    <Bar dataKey=\"avgProgress\" radius={[0, 4, 4, 0]}>\n                                        {activeData.map((entry, index) => (\n                                            <Cell key={`cell-${index}`} fill={entry.color} />\n                                        ))}\n                                    </Bar>\n                                </BarChart>\n                            ) : (\n                                <PieChart>\n                                    <Pie\n                                        data={activeData}\n                                        cx=\"50%\"\n                                        cy=\"50%\"\n                                        innerRadius={70}\n                                        outerRadius={90}\n                                        paddingAngle={5}\n                                        dataKey=\"value\"\n                                    >\n                                        {activeData.map((entry, index) => (\n                                            <Cell key={`cell-${index}`} fill={entry.color} />\n                                        ))}\n                                    </Pie>\n                                    <Tooltip\n                                        formatter={(value: number, name: string, props: any) => {\n                                            if (viewMode === 'list_distribution') {\n                                                return [\n                                                    `${value} tareas`,\n                                                    name\n                                                ];\n                                            }\n                                            return [`${value} tareas`, name];\n                                        }}\n                                        contentStyle={{ borderRadius: '8px', border: 'none', boxShadow: '0 4px 6px -1px rgb(0 0 0 / 0.1)' }}\n                                    />\n                                    <Legend verticalAlign=\"bottom\" height={36} iconType=\"circle\" />\n                                </PieChart>\n                            )}\n                        </ResponsiveContainer>\n                    </div>\n\n                    {/* Stats Summary Panel */}\n                    <div className=\"w-full md:w-2/5 space-y-4 max-h-72 overflow-y-auto pr-2\">\n                        <div className=\"bg-slate-50 p-4 rounded-lg\">\n                            <p className=\"text-sm text-gray-500 mb-1\">Total de Subtareas</p>\n                            <p className=\"text-3xl font-bold text-gray-800\">{totalSubtasks}</p>\n                        </div>\n\n                        <div className=\"space-y-3\">\n                            {activeData.map((item) => (\n                                <div key={item.name} className=\"flex items-center justify-between p-2 hover:bg-slate-50 rounded-md transition-colors\">\n                                    <div className=\"flex items-center gap-2 overflow-hidden\">\n                                        <div className=\"w-3 h-3 rounded-full flex-shrink-0\" style={{ backgroundColor: item.color }}></div>\n                                        <span className=\"text-sm font-medium text-gray-700 truncate\" title={item.name}>{item.name}</span>\n                                    </div>\n\n                                    <div className=\"flex flex-col items-end flex-shrink-0 ml-2\">\n                                        {viewMode === 'list_performance' ? (\n                                            <span className=\"text-sm font-bold text-gray-800\">{(item as any).avgProgress}%</span>\n                                        ) : (\n                                            <>\n                                                <div className=\"flex items-center gap-2\">\n                                                    <span className=\"text-sm font-bold text-gray-800\">{item.value}</span>\n                                                    <span className=\"text-xs text-gray-500 w-10 text-right\">\n                                                        {Math.round((item.value / totalSubtasks) * 100)}%\n                                                    </span>\n                                                </div>\n                                                {viewMode === 'list_distribution' && (\n                                                    <span className=\"text-[10px] text-gray-400\">\n                                                        Avg: {(item as any).avgProgress}%\n                                                    </span>\n                                                )}\n                                            </>\n                                        )}\n                                    </div>\n                                </div>\n                            ))}\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    );\n}\n"],"names":[],"mappings":"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"}}]
}