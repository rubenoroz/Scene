{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/rubenoroz/scena-v1/src/lib/excel.ts"],"sourcesContent":["import ExcelJS from 'exceljs';\nimport { saveAs } from 'file-saver';\n\ninterface ExportTask {\n    id: string;\n    title: string;\n    startDate?: string | null;\n    endDate?: string | null;\n    status?: string;\n    priority?: string | null;\n    assignees?: { name: string | null; email: string | null }[];\n    columnId?: string;\n    level?: number;\n    color?: string; // Column color\n}\n\nexport const exportToExcel = async (tasks: ExportTask[], columns: { id: string; name: string; color?: string }[], projectName: string) => {\n    const workbook = new ExcelJS.Workbook();\n    const worksheet = workbook.addWorksheet('Cronograma');\n\n    // --- 1. Setup Columns ---\n    worksheet.columns = [\n        { header: 'Tarea', key: 'title', width: 40 },\n        { header: 'Estado', key: 'status', width: 15 },\n        { header: 'Prioridad', key: 'priority', width: 12 },\n        { header: 'Asignado a', key: 'assignees', width: 25 },\n        { header: 'Inicio', key: 'startDate', width: 12 },\n        { header: 'Fin', key: 'endDate', width: 12 },\n    ];\n\n    // --- 2. Calculate Timeline Range ---\n    const dates = tasks.flatMap(t => [t.startDate, t.endDate]).filter(Boolean).map(d => new Date(d!));\n    let minDate = dates.length ? new Date(Math.min(...dates.map(d => d.getTime()))) : new Date();\n    let maxDate = dates.length ? new Date(Math.max(...dates.map(d => d.getTime()))) : new Date();\n\n    // Add padding\n    minDate.setDate(minDate.getDate() - 3);\n    maxDate.setDate(maxDate.getDate() + 7);\n\n    // --- 3. Add Timeline Headers ---\n    // We'll add dates starting from column G (index 7, 1-based)\n    let currentDate = new Date(minDate);\n    let colIndex = 7;\n    const dateColMap = new Map<string, number>();\n\n    while (currentDate <= maxDate) {\n        const dateStr = currentDate.toISOString().split('T')[0];\n        const cell = worksheet.getCell(1, colIndex);\n\n        cell.value = currentDate.getDate(); // Just the day number\n        cell.alignment = { horizontal: 'center' };\n\n        // Style the header\n        cell.fill = {\n            type: 'pattern',\n            pattern: 'solid',\n            fgColor: { argb: 'FFE0E0E0' }\n        };\n        cell.border = {\n            left: { style: 'thin', color: { argb: 'FFCCCCCC' } },\n            right: { style: 'thin', color: { argb: 'FFCCCCCC' } }\n        };\n\n        // Add month header above if it's the first day or first col\n        if (currentDate.getDate() === 1 || colIndex === 7) {\n            // We could merge cells for months, but for simplicity let's just put it in the tooltip or comment\n            // Or maybe add a row above. For now, simple day numbers.\n        }\n\n        dateColMap.set(dateStr, colIndex);\n\n        // Set column width for the timeline\n        worksheet.getColumn(colIndex).width = 4;\n\n        currentDate.setDate(currentDate.getDate() + 1);\n        colIndex++;\n    }\n\n    // --- 4. Add Data and Bars ---\n    const columnMap = new Map(columns.map(c => [c.id, c]));\n\n    tasks.forEach((task, index) => {\n        const rowIndex = index + 2; // 1-based, +1 for header\n        const row = worksheet.getRow(rowIndex);\n\n        // Basic Data\n        const statusCol = columnMap.get(task.columnId || '');\n        const statusName = statusCol?.name || 'Unknown';\n        const statusColor = statusCol?.color || '#E0E0E0';\n        const assignees = task.assignees?.map(a => a.name || a.email).join(', ') || '';\n\n        // Indentation for hierarchy\n        const indentation = task.level ? '    '.repeat(task.level) : '';\n\n        row.getCell('title').value = indentation + task.title;\n        row.getCell('status').value = statusName;\n        row.getCell('priority').value = task.priority;\n        row.getCell('assignees').value = assignees;\n        row.getCell('startDate').value = task.startDate ? new Date(task.startDate).toLocaleDateString() : '';\n        row.getCell('endDate').value = task.endDate ? new Date(task.endDate).toLocaleDateString() : '';\n\n        // Gantt Bar Coloring\n        if (task.startDate && task.endDate) {\n            const start = new Date(task.startDate);\n            const end = new Date(task.endDate);\n\n            let curr = new Date(start);\n            while (curr <= end) {\n                const dateStr = curr.toISOString().split('T')[0];\n                const colIdx = dateColMap.get(dateStr);\n\n                if (colIdx) {\n                    const cell = row.getCell(colIdx);\n                    // Remove # from hex color\n                    const argbColor = 'FF' + (statusColor.replace('#', '') || '3B82F6');\n\n                    cell.fill = {\n                        type: 'pattern',\n                        pattern: 'solid',\n                        fgColor: { argb: argbColor }\n                    };\n                }\n                curr.setDate(curr.getDate() + 1);\n            }\n        }\n    });\n\n    // --- 5. Final Styling ---\n    // Header row style\n    worksheet.getRow(1).font = { bold: true };\n    worksheet.getRow(1).border = { bottom: { style: 'medium' } };\n\n    // Generate File\n    const buffer = await workbook.xlsx.writeBuffer();\n    const fileName = `${projectName.replace(/\\s+/g, '_')}_Gantt_Visual.xlsx`;\n    saveAs(new Blob([buffer]), fileName);\n};\n"],"names":[],"mappings":"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"}}]
}