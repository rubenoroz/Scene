{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///Users/rubenoroz/scena-v1/src/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from \"@prisma/client\";\n\nconst prismaClientSingleton = () => {\n  return new PrismaClient();\n};\n\ndeclare global {\n  var prisma: undefined | ReturnType<typeof prismaClientSingleton>;\n}\n\nconst prisma = globalThis.prisma ?? prismaClientSingleton();\n\nexport default prisma;\n\nif (process.env.NODE_ENV !== \"production\") globalThis.prisma = prisma;"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,wBAAwB;IAC5B,OAAO,IAAI,6IAAY;AACzB;AAMA,MAAM,SAAS,WAAW,MAAM,IAAI;uCAErB;AAEf,wCAA2C,WAAW,MAAM,GAAG"}},
    {"offset": {"line": 128, "column": 0}, "map": {"version":3,"sources":["file:///Users/rubenoroz/scena-v1/src/lib/auth.ts"],"sourcesContent":["import NextAuth, { getServerSession, AuthOptions } from \"next-auth\"; // Import getServerSession\nimport { PrismaAdapter } from \"@auth/prisma-adapter\";\nimport GitHub from \"next-auth/providers/github\";\nimport CredentialsProvider from \"next-auth/providers/credentials\";\nimport bcrypt from \"bcryptjs\";\nimport prisma from \"@/lib/prisma\"; // Import the singleton Prisma client\n\n// This is your auth configuration\nexport const authOptions: AuthOptions = {\n  adapter: PrismaAdapter(prisma),\n  providers: [\n    GitHub({\n      clientId: process.env.GITHUB_ID ?? \"\",\n      clientSecret: process.env.GITHUB_SECRET ?? \"\",\n    }),\n    CredentialsProvider({\n      name: \"Credentials\",\n      credentials: {\n        email: { label: \"Email\", type: \"text\" },\n        password: { label: \"Password\", type: \"password\" },\n      },\n      async authorize(credentials, req) {\n        if (!credentials?.email || !credentials?.password) {\n          return null;\n        }\n\n        const user = await prisma.user.findUnique({\n          where: {\n            email: credentials.email,\n          },\n        });\n\n        if (!user || !user.hashedPassword) {\n          return null;\n        }\n\n        const isValid = await bcrypt.compare(\n          credentials.password,\n          user.hashedPassword\n        );\n\n        if (isValid) {\n          return user;\n        }\n\n        return null;\n      },\n    }),\n  ],\n  session: {\n    strategy: \"jwt\",\n  },\n  callbacks: {\n    async jwt({ token, user }) {\n      console.log(\"JWT Callback - Token:\", token);\n      console.log(\"JWT Callback - User:\", user);\n      if (user) {\n        token.id = user.id;\n      }\n      return token;\n    },\n    async session({ session, token }) {\n      console.log(\"Session Callback - Session:\", session);\n      console.log(\"Session Callback - Token:\", token);\n      if (session.user) {\n        session.user.id = token.id as string;\n      }\n      return session;\n    },\n  },\n  pages: {\n    signIn: '/', // Specify your sign-in page\n  },\n  secret: process.env.NEXTAUTH_SECRET,\n  debug: process.env.NODE_ENV === 'development',\n};\n\n// This is the handler for the [...nextauth] route\n// It's used by app/api/auth/[...nextauth]/route.ts\nexport const { handlers } = NextAuth(authOptions);\n\n// This is the server-side auth helper for NextAuth.js v4 in App Router\nexport async function auth() {\n  return getServerSession(authOptions);\n}\n"],"names":[],"mappings":";;;;;;;;AAAA,6OAAqE,0BAA0B;AAC/F;AACA;AACA;AACA;AACA,8MAAmC,qCAAqC;;;;;;;AAGjE,MAAM,cAA2B;IACtC,SAAS,IAAA,uKAAa,EAAC,iIAAM;IAC7B,WAAW;QACT,IAAA,gKAAM,EAAC;YACL,UAAU,QAAQ,GAAG,CAAC,SAAS,IAAI;YACnC,cAAc,QAAQ,GAAG,CAAC,aAAa,IAAI;QAC7C;QACA,IAAA,qKAAmB,EAAC;YAClB,MAAM;YACN,aAAa;gBACX,OAAO;oBAAE,OAAO;oBAAS,MAAM;gBAAO;gBACtC,UAAU;oBAAE,OAAO;oBAAY,MAAM;gBAAW;YAClD;YACA,MAAM,WAAU,WAAW,EAAE,GAAG;gBAC9B,IAAI,CAAC,aAAa,SAAS,CAAC,aAAa,UAAU;oBACjD,OAAO;gBACT;gBAEA,MAAM,OAAO,MAAM,iIAAM,CAAC,IAAI,CAAC,UAAU,CAAC;oBACxC,OAAO;wBACL,OAAO,YAAY,KAAK;oBAC1B;gBACF;gBAEA,IAAI,CAAC,QAAQ,CAAC,KAAK,cAAc,EAAE;oBACjC,OAAO;gBACT;gBAEA,MAAM,UAAU,MAAM,8IAAM,CAAC,OAAO,CAClC,YAAY,QAAQ,EACpB,KAAK,cAAc;gBAGrB,IAAI,SAAS;oBACX,OAAO;gBACT;gBAEA,OAAO;YACT;QACF;KACD;IACD,SAAS;QACP,UAAU;IACZ;IACA,WAAW;QACT,MAAM,KAAI,EAAE,KAAK,EAAE,IAAI,EAAE;YACvB,QAAQ,GAAG,CAAC,yBAAyB;YACrC,QAAQ,GAAG,CAAC,wBAAwB;YACpC,IAAI,MAAM;gBACR,MAAM,EAAE,GAAG,KAAK,EAAE;YACpB;YACA,OAAO;QACT;QACA,MAAM,SAAQ,EAAE,OAAO,EAAE,KAAK,EAAE;YAC9B,QAAQ,GAAG,CAAC,+BAA+B;YAC3C,QAAQ,GAAG,CAAC,6BAA6B;YACzC,IAAI,QAAQ,IAAI,EAAE;gBAChB,QAAQ,IAAI,CAAC,EAAE,GAAG,MAAM,EAAE;YAC5B;YACA,OAAO;QACT;IACF;IACA,OAAO;QACL,QAAQ;IACV;IACA,QAAQ,QAAQ,GAAG,CAAC,eAAe;IACnC,OAAO,oDAAyB;AAClC;AAIO,MAAM,EAAE,QAAQ,EAAE,GAAG,IAAA,kJAAQ,EAAC;AAG9B,eAAe;IACpB,OAAO,IAAA,2JAAgB,EAAC;AAC1B"}},
    {"offset": {"line": 222, "column": 0}, "map": {"version":3,"sources":["file:///Users/rubenoroz/scena-v1/src/app/api/projects/%5BprojectId%5D/tasks/%5BtaskId%5D/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\nimport prisma from \"@/lib/prisma\";\nimport { auth } from \"@/lib/auth\";\n\n// GET /api/projects/[projectId]/tasks/[taskId]\nexport async function GET(\n  req: NextRequest,\n  { params }: { params: Promise<{ projectId: string; taskId: string }> }\n) {\n  try {\n    const session = await auth();\n    if (!session) {\n      return NextResponse.json({ message: \"Unauthorized\" }, { status: 401 });\n    }\n\n    const { projectId, taskId } = await params;\n\n    const task = await prisma.task.findUnique({\n      where: { id: taskId, projectId },\n      include: {\n        assignees: {\n          select: {\n            id: true,\n            name: true,\n            email: true,\n            image: true,\n          },\n        },\n        children: {\n          include: {\n            children: {\n              include: {\n                children: {\n                  include: {\n                    children: {\n                      include: {\n                        children: true, // 5th level\n                      },\n                    },\n                  },\n                },\n              },\n            },\n          },\n        },\n        parent: true, // Include parent task if it's a subtask\n      },\n    });\n\n    if (!task) {\n      return NextResponse.json({ message: \"Task not found\" }, { status: 404 });\n    }\n\n    return NextResponse.json(task);\n  } catch (error) {\n    console.error(\"Error fetching task:\", error);\n    return NextResponse.json(\n      { message: \"Error fetching task\" },\n      { status: 500 }\n    );\n  }\n}\n\n// PUT /api/projects/[projectId]/tasks/[taskId]\nexport async function PUT(\n  req: NextRequest,\n  { params }: { params: Promise<{ projectId: string; taskId: string }> }\n) {\n  try {\n    const session = await auth();\n    if (!session) {\n      return NextResponse.json({ message: \"Unauthorized\" }, { status: 401 });\n    }\n\n    const { projectId, taskId } = await params;\n    const {\n      title,\n      description,\n      columnId,\n      order,\n      parentId,\n      assignees,\n      startDate,\n      endDate,\n      toleranceDate,\n      links,\n      attachments,\n      images,\n      tags,\n      priority,\n      checklist\n    } = await req.json();\n\n    // First, fetch the current task to check if we need to cascade move\n    const currentTask = await prisma.task.findUnique({\n      where: { id: taskId, projectId },\n      include: { children: true },\n    });\n\n    if (!currentTask) {\n      return NextResponse.json({ message: \"Task not found\" }, { status: 404 });\n    }\n\n    // Check if columnId is changing and if this task has children\n    const isColumnChanging = columnId !== undefined && columnId !== currentTask.columnId;\n    const hasChildren = currentTask.children && currentTask.children.length > 0;\n\n    // Use a transaction to update the task and its children atomically\n    const updatedTask = await prisma.$transaction(async (tx) => {\n      // Update the main task\n      const updated = await tx.task.update({\n        where: { id: taskId, projectId },\n        data: {\n          title: title !== undefined ? title : undefined,\n          description: description !== undefined ? description : undefined,\n          columnId: columnId !== undefined ? columnId : undefined,\n          order: order !== undefined ? order : undefined,\n          parentId: parentId !== undefined ? parentId : undefined,\n          startDate: startDate !== undefined ? (startDate ? new Date(startDate) : null) : undefined,\n          endDate: endDate !== undefined ? (endDate ? new Date(endDate) : null) : undefined,\n          toleranceDate: toleranceDate !== undefined ? (toleranceDate ? new Date(toleranceDate) : null) : undefined,\n          links: links !== undefined ? JSON.stringify(links) : undefined,\n          attachments: attachments !== undefined ? JSON.stringify(attachments) : undefined,\n          images: images !== undefined ? JSON.stringify(images) : undefined,\n          tags: tags !== undefined ? JSON.stringify(tags) : undefined,\n          priority: priority !== undefined ? priority : undefined,\n          checklist: checklist !== undefined ? JSON.stringify(checklist) : undefined,\n          assignees: assignees !== undefined ? {\n            set: assignees.map((id: string) => ({ id }))\n          } : undefined,\n        },\n      });\n\n      // If column is changing and task has children, move ALL descendants recursively\n      if (isColumnChanging && hasChildren) {\n        // Recursive function to get all descendant IDs\n        const getAllDescendantIds = async (parentTaskId: string): Promise<string[]> => {\n          const children = await tx.task.findMany({\n            where: { parentId: parentTaskId },\n            select: { id: true },\n          });\n\n          if (children.length === 0) return [];\n\n          const childIds = children.map(c => c.id);\n          const grandchildIds = await Promise.all(\n            childIds.map(id => getAllDescendantIds(id))\n          );\n\n          return [...childIds, ...grandchildIds.flat()];\n        };\n\n        // Get all descendant IDs\n        const descendantIds = await getAllDescendantIds(taskId);\n\n        // Update all descendants to the new column\n        if (descendantIds.length > 0) {\n          await tx.task.updateMany({\n            where: { id: { in: descendantIds } },\n            data: { columnId },\n          });\n        }\n      }\n\n      return updated;\n    });\n\n    // Fetch the updated task with assignees to return complete data\n    const taskWithAssignees = await prisma.task.findUnique({\n      where: { id: taskId },\n      include: {\n        assignees: {\n          select: {\n            id: true,\n            name: true,\n            email: true,\n            image: true,\n          },\n        },\n      },\n    });\n\n    return NextResponse.json(taskWithAssignees || updatedTask);\n  } catch (error) {\n    console.error(\"Error updating task:\", error);\n    return NextResponse.json(\n      { message: \"Error updating task\" },\n      { status: 500 }\n    );\n  }\n}\n\n// DELETE /api/projects/[projectId]/tasks/[taskId]\nexport async function DELETE(\n  req: NextRequest,\n  { params }: { params: Promise<{ projectId: string; taskId: string }> }\n) {\n  try {\n    const session = await auth();\n    if (!session) {\n      return NextResponse.json({ message: \"Unauthorized\" }, { status: 401 });\n    }\n\n    const { projectId, taskId } = await params;\n\n    await prisma.task.delete({\n      where: { id: taskId, projectId },\n    });\n\n    return NextResponse.json({ message: \"Task deleted\" }, { status: 200 });\n  } catch (error) {\n    console.error(\"Error deleting task:\", error);\n    return NextResponse.json(\n      { message: \"Error deleting task\" },\n      { status: 500 }\n    );\n  }\n}"],"names":[],"mappings":"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"}}]
}