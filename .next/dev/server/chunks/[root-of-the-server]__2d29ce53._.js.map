{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 112, "column": 0}, "map": {"version":3,"sources":["file:///Users/rubenoroz/scena-v1/src/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from \"@prisma/client\";\n\nconst prismaClientSingleton = () => {\n  return new PrismaClient();\n};\n\ndeclare global {\n  var prisma: undefined | ReturnType<typeof prismaClientSingleton>;\n}\n\nconst prisma = globalThis.prisma ?? prismaClientSingleton();\n\nexport default prisma;\n\nif (process.env.NODE_ENV !== \"production\") globalThis.prisma = prisma;"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,wBAAwB;IAC5B,OAAO,IAAI,6IAAY;AACzB;AAMA,MAAM,SAAS,WAAW,MAAM,IAAI;uCAErB;AAEf,wCAA2C,WAAW,MAAM,GAAG"}},
    {"offset": {"line": 128, "column": 0}, "map": {"version":3,"sources":["file:///Users/rubenoroz/scena-v1/src/lib/auth.ts"],"sourcesContent":["import NextAuth, { getServerSession, AuthOptions } from \"next-auth\"; // Import getServerSession\nimport { PrismaAdapter } from \"@auth/prisma-adapter\";\nimport GitHub from \"next-auth/providers/github\";\nimport CredentialsProvider from \"next-auth/providers/credentials\";\nimport bcrypt from \"bcryptjs\";\nimport prisma from \"@/lib/prisma\"; // Import the singleton Prisma client\n\n// This is your auth configuration\nexport const authOptions: AuthOptions = {\n  adapter: PrismaAdapter(prisma),\n  providers: [\n    GitHub({\n      clientId: process.env.GITHUB_ID ?? \"\",\n      clientSecret: process.env.GITHUB_SECRET ?? \"\",\n    }),\n    CredentialsProvider({\n      name: \"Credentials\",\n      credentials: {\n        email: { label: \"Email\", type: \"text\" },\n        password: { label: \"Password\", type: \"password\" },\n      },\n      async authorize(credentials, req) {\n        if (!credentials?.email || !credentials?.password) {\n          return null;\n        }\n\n        const user = await prisma.user.findUnique({\n          where: {\n            email: credentials.email,\n          },\n        });\n\n        if (!user || !user.hashedPassword) {\n          return null;\n        }\n\n        const isValid = await bcrypt.compare(\n          credentials.password,\n          user.hashedPassword\n        );\n\n        if (isValid) {\n          return user;\n        }\n\n        return null;\n      },\n    }),\n  ],\n  session: {\n    strategy: \"jwt\",\n  },\n  callbacks: {\n    async jwt({ token, user }) {\n      console.log(\"JWT Callback - Token:\", token);\n      console.log(\"JWT Callback - User:\", user);\n      if (user) {\n        token.id = user.id;\n      }\n      return token;\n    },\n    async session({ session, token }) {\n      console.log(\"Session Callback - Session:\", session);\n      console.log(\"Session Callback - Token:\", token);\n      if (session.user) {\n        session.user.id = token.id as string;\n      }\n      return session;\n    },\n  },\n  pages: {\n    signIn: '/', // Specify your sign-in page\n  },\n  secret: process.env.NEXTAUTH_SECRET,\n  debug: process.env.NODE_ENV === 'development',\n};\n\n// This is the handler for the [...nextauth] route\n// It's used by app/api/auth/[...nextauth]/route.ts\nexport const { handlers } = NextAuth(authOptions);\n\n// This is the server-side auth helper for NextAuth.js v4 in App Router\nexport async function auth() {\n  return getServerSession(authOptions);\n}\n"],"names":[],"mappings":";;;;;;;;AAAA,6OAAqE,0BAA0B;AAC/F;AACA;AACA;AACA;AACA,8MAAmC,qCAAqC;;;;;;;AAGjE,MAAM,cAA2B;IACtC,SAAS,IAAA,uKAAa,EAAC,iIAAM;IAC7B,WAAW;QACT,IAAA,gKAAM,EAAC;YACL,UAAU,QAAQ,GAAG,CAAC,SAAS,IAAI;YACnC,cAAc,QAAQ,GAAG,CAAC,aAAa,IAAI;QAC7C;QACA,IAAA,qKAAmB,EAAC;YAClB,MAAM;YACN,aAAa;gBACX,OAAO;oBAAE,OAAO;oBAAS,MAAM;gBAAO;gBACtC,UAAU;oBAAE,OAAO;oBAAY,MAAM;gBAAW;YAClD;YACA,MAAM,WAAU,WAAW,EAAE,GAAG;gBAC9B,IAAI,CAAC,aAAa,SAAS,CAAC,aAAa,UAAU;oBACjD,OAAO;gBACT;gBAEA,MAAM,OAAO,MAAM,iIAAM,CAAC,IAAI,CAAC,UAAU,CAAC;oBACxC,OAAO;wBACL,OAAO,YAAY,KAAK;oBAC1B;gBACF;gBAEA,IAAI,CAAC,QAAQ,CAAC,KAAK,cAAc,EAAE;oBACjC,OAAO;gBACT;gBAEA,MAAM,UAAU,MAAM,8IAAM,CAAC,OAAO,CAClC,YAAY,QAAQ,EACpB,KAAK,cAAc;gBAGrB,IAAI,SAAS;oBACX,OAAO;gBACT;gBAEA,OAAO;YACT;QACF;KACD;IACD,SAAS;QACP,UAAU;IACZ;IACA,WAAW;QACT,MAAM,KAAI,EAAE,KAAK,EAAE,IAAI,EAAE;YACvB,QAAQ,GAAG,CAAC,yBAAyB;YACrC,QAAQ,GAAG,CAAC,wBAAwB;YACpC,IAAI,MAAM;gBACR,MAAM,EAAE,GAAG,KAAK,EAAE;YACpB;YACA,OAAO;QACT;QACA,MAAM,SAAQ,EAAE,OAAO,EAAE,KAAK,EAAE;YAC9B,QAAQ,GAAG,CAAC,+BAA+B;YAC3C,QAAQ,GAAG,CAAC,6BAA6B;YACzC,IAAI,QAAQ,IAAI,EAAE;gBAChB,QAAQ,IAAI,CAAC,EAAE,GAAG,MAAM,EAAE;YAC5B;YACA,OAAO;QACT;IACF;IACA,OAAO;QACL,QAAQ;IACV;IACA,QAAQ,QAAQ,GAAG,CAAC,eAAe;IACnC,OAAO,oDAAyB;AAClC;AAIO,MAAM,EAAE,QAAQ,EAAE,GAAG,IAAA,kJAAQ,EAAC;AAG9B,eAAe;IACpB,OAAO,IAAA,2JAAgB,EAAC;AAC1B"}},
    {"offset": {"line": 240, "column": 0}, "map": {"version":3,"sources":["file:///Users/rubenoroz/scena-v1/src/app/api/upload/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\nimport { auth } from \"@/lib/auth\";\nimport { writeFile, mkdir } from \"fs/promises\";\nimport { join } from \"path\";\nimport { existsSync } from \"fs\";\n\n// Configure max file size (50MB)\nconst MAX_FILE_SIZE = 50 * 1024 * 1024; // 50MB in bytes\n\n// Allowed file types\nconst ALLOWED_TYPES = [\n    // Images\n    \"image/jpeg\",\n    \"image/jpg\",\n    \"image/png\",\n    \"image/gif\",\n    \"image/webp\",\n    // Videos\n    \"video/mp4\",\n    \"video/quicktime\",\n    \"video/x-msvideo\",\n    // Documents\n    \"application/pdf\",\n    \"application/msword\",\n    \"application/vnd.openxmlformats-officedocument.wordprocessingml.document\",\n    // Excel\n    \"application/vnd.ms-excel\",\n    \"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet\",\n    // PowerPoint\n    \"application/vnd.ms-powerpoint\",\n    \"application/vnd.openxmlformats-officedocument.presentationml.presentation\",\n    // Design files\n    \"application/x-photoshop\",\n    \"application/postscript\",\n    // Archives\n    \"application/zip\",\n    \"application/x-rar-compressed\",\n    \"application/x-7z-compressed\",\n    // Text files\n    \"text/plain\",\n    \"text/csv\",\n];\n\nexport async function POST(req: NextRequest) {\n    try {\n        const session = await auth();\n        if (!session) {\n            return NextResponse.json({ message: \"Unauthorized\" }, { status: 401 });\n        }\n\n        const formData = await req.formData();\n        const file = formData.get(\"file\") as File;\n        const projectId = formData.get(\"projectId\") as string;\n        const taskId = formData.get(\"taskId\") as string;\n\n        if (!file) {\n            return NextResponse.json({ message: \"No file provided\" }, { status: 400 });\n        }\n\n        if (!projectId || !taskId) {\n            return NextResponse.json(\n                { message: \"Project ID and Task ID are required\" },\n                { status: 400 }\n            );\n        }\n\n        // Validate file size\n        if (file.size > MAX_FILE_SIZE) {\n            return NextResponse.json(\n                { message: \"File size exceeds 50MB limit\" },\n                { status: 400 }\n            );\n        }\n\n        // Validate file type\n        if (!ALLOWED_TYPES.includes(file.type)) {\n            return NextResponse.json(\n                { message: `File type ${file.type} is not allowed` },\n                { status: 400 }\n            );\n        }\n\n        // Create directory structure\n        const uploadDir = join(process.cwd(), \"public\", \"uploads\", projectId, taskId);\n        if (!existsSync(uploadDir)) {\n            await mkdir(uploadDir, { recursive: true });\n        }\n\n        // Generate unique filename\n        const timestamp = Date.now();\n        const originalName = file.name.replace(/[^a-zA-Z0-9.-]/g, \"_\");\n        const filename = `${timestamp}_${originalName}`;\n        const filepath = join(uploadDir, filename);\n\n        // Convert file to buffer and save\n        const bytes = await file.arrayBuffer();\n        const buffer = Buffer.from(bytes);\n        await writeFile(filepath, buffer);\n\n        // Return file URL\n        const fileUrl = `/uploads/${projectId}/${taskId}/${filename}`;\n\n        return NextResponse.json({\n            url: fileUrl,\n            name: file.name,\n            size: file.size,\n            type: file.type,\n            uploadedAt: new Date().toISOString(),\n        });\n    } catch (error) {\n        console.error(\"Error uploading file:\", error);\n        return NextResponse.json(\n            { message: \"Error uploading file\" },\n            { status: 500 }\n        );\n    }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;AACA;;;;;;AAEA,iCAAiC;AACjC,MAAM,gBAAgB,KAAK,OAAO,MAAM,gBAAgB;AAExD,qBAAqB;AACrB,MAAM,gBAAgB;IAClB,SAAS;IACT;IACA;IACA;IACA;IACA;IACA,SAAS;IACT;IACA;IACA;IACA,YAAY;IACZ;IACA;IACA;IACA,QAAQ;IACR;IACA;IACA,aAAa;IACb;IACA;IACA,eAAe;IACf;IACA;IACA,WAAW;IACX;IACA;IACA;IACA,aAAa;IACb;IACA;CACH;AAEM,eAAe,KAAK,GAAgB;IACvC,IAAI;QACA,MAAM,UAAU,MAAM,IAAA,4HAAI;QAC1B,IAAI,CAAC,SAAS;YACV,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;YAAe,GAAG;gBAAE,QAAQ;YAAI;QACxE;QAEA,MAAM,WAAW,MAAM,IAAI,QAAQ;QACnC,MAAM,OAAO,SAAS,GAAG,CAAC;QAC1B,MAAM,YAAY,SAAS,GAAG,CAAC;QAC/B,MAAM,SAAS,SAAS,GAAG,CAAC;QAE5B,IAAI,CAAC,MAAM;YACP,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;YAAmB,GAAG;gBAAE,QAAQ;YAAI;QAC5E;QAEA,IAAI,CAAC,aAAa,CAAC,QAAQ;YACvB,OAAO,gJAAY,CAAC,IAAI,CACpB;gBAAE,SAAS;YAAsC,GACjD;gBAAE,QAAQ;YAAI;QAEtB;QAEA,qBAAqB;QACrB,IAAI,KAAK,IAAI,GAAG,eAAe;YAC3B,OAAO,gJAAY,CAAC,IAAI,CACpB;gBAAE,SAAS;YAA+B,GAC1C;gBAAE,QAAQ;YAAI;QAEtB;QAEA,qBAAqB;QACrB,IAAI,CAAC,cAAc,QAAQ,CAAC,KAAK,IAAI,GAAG;YACpC,OAAO,gJAAY,CAAC,IAAI,CACpB;gBAAE,SAAS,CAAC,UAAU,EAAE,KAAK,IAAI,CAAC,eAAe,CAAC;YAAC,GACnD;gBAAE,QAAQ;YAAI;QAEtB;QAEA,6BAA6B;QAC7B,MAAM,YAAY,IAAA,yGAAI,EAAC,QAAQ,GAAG,IAAI,UAAU,WAAW,WAAW;QACtE,IAAI,CAAC,IAAA,2GAAU,EAAC,YAAY;YACxB,MAAM,IAAA,8HAAK,EAAC,WAAW;gBAAE,WAAW;YAAK;QAC7C;QAEA,2BAA2B;QAC3B,MAAM,YAAY,KAAK,GAAG;QAC1B,MAAM,eAAe,KAAK,IAAI,CAAC,OAAO,CAAC,mBAAmB;QAC1D,MAAM,WAAW,GAAG,UAAU,CAAC,EAAE,cAAc;QAC/C,MAAM,WAAW,IAAA,yGAAI,EAAC,WAAW;QAEjC,kCAAkC;QAClC,MAAM,QAAQ,MAAM,KAAK,WAAW;QACpC,MAAM,SAAS,OAAO,IAAI,CAAC;QAC3B,MAAM,IAAA,kIAAS,EAAC,UAAU;QAE1B,kBAAkB;QAClB,MAAM,UAAU,CAAC,SAAS,EAAE,UAAU,CAAC,EAAE,OAAO,CAAC,EAAE,UAAU;QAE7D,OAAO,gJAAY,CAAC,IAAI,CAAC;YACrB,KAAK;YACL,MAAM,KAAK,IAAI;YACf,MAAM,KAAK,IAAI;YACf,MAAM,KAAK,IAAI;YACf,YAAY,IAAI,OAAO,WAAW;QACtC;IACJ,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,yBAAyB;QACvC,OAAO,gJAAY,CAAC,IAAI,CACpB;YAAE,SAAS;QAAuB,GAClC;YAAE,QAAQ;QAAI;IAEtB;AACJ"}}]
}