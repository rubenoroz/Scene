{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///Users/rubenoroz/scena-v1/src/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from \"@prisma/client\";\n\n// Force reload for schema changes\n\nconst prismaClientSingleton = () => {\n  return new PrismaClient();\n};\n\ndeclare global {\n  var prisma: undefined | ReturnType<typeof prismaClientSingleton>;\n}\n\n// Workaround: Force new client instance to pick up schema changes in dev\nif (process.env.NODE_ENV !== \"production\") {\n  globalThis.prisma = undefined;\n}\n\nconst prisma = globalThis.prisma ?? prismaClientSingleton();\n\nexport default prisma;\n\nif (process.env.NODE_ENV !== \"production\") globalThis.prisma = prisma;"],"names":[],"mappings":";;;;AAAA;;AAEA,kCAAkC;AAElC,MAAM,wBAAwB;IAC5B,OAAO,IAAI,6IAAY;AACzB;AAMA,yEAAyE;AACzE,wCAA2C;IACzC,WAAW,MAAM,GAAG;AACtB;AAEA,MAAM,SAAS,WAAW,MAAM,IAAI;uCAErB;AAEf,wCAA2C,WAAW,MAAM,GAAG"}},
    {"offset": {"line": 133, "column": 0}, "map": {"version":3,"sources":["file:///Users/rubenoroz/scena-v1/src/lib/auth.ts"],"sourcesContent":["import NextAuth, { getServerSession, AuthOptions } from \"next-auth\"; // Import getServerSession\nimport { PrismaAdapter } from \"@auth/prisma-adapter\";\nimport GitHub from \"next-auth/providers/github\";\nimport CredentialsProvider from \"next-auth/providers/credentials\";\nimport bcrypt from \"bcryptjs\";\nimport prisma from \"@/lib/prisma\"; // Import the singleton Prisma client\n\n// This is your auth configuration\nexport const authOptions: AuthOptions = {\n  adapter: PrismaAdapter(prisma),\n  providers: [\n    GitHub({\n      clientId: process.env.GITHUB_ID ?? \"\",\n      clientSecret: process.env.GITHUB_SECRET ?? \"\",\n    }),\n    CredentialsProvider({\n      name: \"Credentials\",\n      credentials: {\n        email: { label: \"Email\", type: \"text\" },\n        password: { label: \"Password\", type: \"password\" },\n      },\n      async authorize(credentials, req) {\n        if (!credentials?.email || !credentials?.password) {\n          return null;\n        }\n\n        const user = await prisma.user.findUnique({\n          where: {\n            email: credentials.email,\n          },\n        });\n\n        if (!user || !user.hashedPassword) {\n          return null;\n        }\n\n        const isValid = await bcrypt.compare(\n          credentials.password,\n          user.hashedPassword\n        );\n\n        if (isValid) {\n          return user;\n        }\n\n        return null;\n      },\n    }),\n  ],\n  session: {\n    strategy: \"jwt\",\n  },\n  callbacks: {\n    async jwt({ token, user }) {\n      console.log(\"JWT Callback - Token:\", token);\n      console.log(\"JWT Callback - User:\", user);\n      if (user) {\n        token.id = user.id;\n        token.role = user.role; // Assign role from the user object\n      }\n\n      // If the user's role is SUPERADMIN, set isSuperAdmin to true\n      token.isSuperAdmin = token.role === \"SUPERADMIN\";\n\n      return token;\n    },\n    async session({ session, token }) {\n      console.log(\"Session Callback - Session:\", session);\n      console.log(\"Session Callback - Token:\", token);\n      if (session.user) {\n        session.user.id = token.id as string;\n        session.user.role = token.role; // Assign role from the token\n        session.user.isSuperAdmin = token.isSuperAdmin; // Assign isSuperAdmin from the token\n      }\n      return session;\n    },\n  },\n  pages: {\n    signIn: '/', // Specify your sign-in page\n  },\n  secret: process.env.NEXTAUTH_SECRET,\n  debug: process.env.NODE_ENV === 'development',\n};\n\n// This is the handler for the [...nextauth] route\n// It's used by app/api/auth/[...nextauth]/route.ts\nexport const { handlers } = NextAuth(authOptions);\n\n// This is the server-side auth helper for NextAuth.js v4 in App Router\nexport async function auth() {\n  return getServerSession(authOptions);\n}\n"],"names":[],"mappings":";;;;;;;;AAAA,6OAAqE,0BAA0B;AAC/F;AACA;AACA;AACA;AACA,8MAAmC,qCAAqC;;;;;;;AAGjE,MAAM,cAA2B;IACtC,SAAS,IAAA,uKAAa,EAAC,iIAAM;IAC7B,WAAW;QACT,IAAA,gKAAM,EAAC;YACL,UAAU,QAAQ,GAAG,CAAC,SAAS,IAAI;YACnC,cAAc,QAAQ,GAAG,CAAC,aAAa,IAAI;QAC7C;QACA,IAAA,qKAAmB,EAAC;YAClB,MAAM;YACN,aAAa;gBACX,OAAO;oBAAE,OAAO;oBAAS,MAAM;gBAAO;gBACtC,UAAU;oBAAE,OAAO;oBAAY,MAAM;gBAAW;YAClD;YACA,MAAM,WAAU,WAAW,EAAE,GAAG;gBAC9B,IAAI,CAAC,aAAa,SAAS,CAAC,aAAa,UAAU;oBACjD,OAAO;gBACT;gBAEA,MAAM,OAAO,MAAM,iIAAM,CAAC,IAAI,CAAC,UAAU,CAAC;oBACxC,OAAO;wBACL,OAAO,YAAY,KAAK;oBAC1B;gBACF;gBAEA,IAAI,CAAC,QAAQ,CAAC,KAAK,cAAc,EAAE;oBACjC,OAAO;gBACT;gBAEA,MAAM,UAAU,MAAM,8IAAM,CAAC,OAAO,CAClC,YAAY,QAAQ,EACpB,KAAK,cAAc;gBAGrB,IAAI,SAAS;oBACX,OAAO;gBACT;gBAEA,OAAO;YACT;QACF;KACD;IACD,SAAS;QACP,UAAU;IACZ;IACA,WAAW;QACT,MAAM,KAAI,EAAE,KAAK,EAAE,IAAI,EAAE;YACvB,QAAQ,GAAG,CAAC,yBAAyB;YACrC,QAAQ,GAAG,CAAC,wBAAwB;YACpC,IAAI,MAAM;gBACR,MAAM,EAAE,GAAG,KAAK,EAAE;gBAClB,MAAM,IAAI,GAAG,KAAK,IAAI,EAAE,mCAAmC;YAC7D;YAEA,6DAA6D;YAC7D,MAAM,YAAY,GAAG,MAAM,IAAI,KAAK;YAEpC,OAAO;QACT;QACA,MAAM,SAAQ,EAAE,OAAO,EAAE,KAAK,EAAE;YAC9B,QAAQ,GAAG,CAAC,+BAA+B;YAC3C,QAAQ,GAAG,CAAC,6BAA6B;YACzC,IAAI,QAAQ,IAAI,EAAE;gBAChB,QAAQ,IAAI,CAAC,EAAE,GAAG,MAAM,EAAE;gBAC1B,QAAQ,IAAI,CAAC,IAAI,GAAG,MAAM,IAAI,EAAE,6BAA6B;gBAC7D,QAAQ,IAAI,CAAC,YAAY,GAAG,MAAM,YAAY,EAAE,qCAAqC;YACvF;YACA,OAAO;QACT;IACF;IACA,OAAO;QACL,QAAQ;IACV;IACA,QAAQ,QAAQ,GAAG,CAAC,eAAe;IACnC,OAAO,oDAAyB;AAClC;AAIO,MAAM,EAAE,QAAQ,EAAE,GAAG,IAAA,kJAAQ,EAAC;AAG9B,eAAe;IACpB,OAAO,IAAA,2JAAgB,EAAC;AAC1B"}},
    {"offset": {"line": 232, "column": 0}, "map": {"version":3,"sources":["file:///Users/rubenoroz/scena-v1/src/app/api/projects/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\nimport prisma from \"@/lib/prisma\"; // Import the singleton Prisma client\nimport { auth, authOptions } from \"@/lib/auth\"; // Import auth and authOptions\n\nexport async function GET(request: Request) {\n  try {\n    const session = await auth(); // Use the auth helper\n\n    if (!session || !session.user?.id) {\n      return NextResponse.json({ message: \"Unauthorized\" }, { status: 401 });\n    }\n\n    // The userId is now taken from the session, not the query params for security\n    const userId = session.user.id;\n\n    const { searchParams } = new URL(request.url);\n    const isArchived = searchParams.get(\"archived\") === \"true\";\n\n    const projects = await prisma.project.findMany({\n      where: {\n        ownerId: userId,\n      },\n      select: {\n        id: true,\n        name: true,\n        description: true,\n      },\n    });\n\n    return NextResponse.json(projects, { status: 200 });\n  } catch (error) {\n    console.error(\"API_PROJECTS_GET_ERROR\", error);\n    return NextResponse.json(\n      { message: \"Internal Server Error\", error: error instanceof Error ? error.message : String(error) },\n      { status: 500 }\n    );\n  }\n}\n\nexport async function POST(request: Request) {\n  try {\n    const session = await auth(); // Use the auth helper\n\n    if (!session || !session.user?.id) {\n      return NextResponse.json({ message: \"Unauthorized\" }, { status: 401 });\n    }\n\n    const userId = session.user.id;\n\n    // Verify user exists in DB (in case of DB reset while session is active)\n    const user = await prisma.user.findUnique({\n      where: { id: userId },\n    });\n\n    if (!user) {\n      return NextResponse.json(\n        { message: \"User not found. Please sign in again.\" },\n        { status: 401 }\n      );\n    }\n\n    const { name, description } = await request.json();\n\n    if (!name) {\n      return NextResponse.json(\n        { message: \"Project name is required\" },\n        { status: 400 }\n      );\n    }\n\n    // For simplicity, we'll find or create a default workspace for the user.\n    // In a real multi-tenant app, this would be more sophisticated.\n    let workspace = await prisma.workspace.findFirst({\n      where: {\n        users: {\n          some: {\n            id: userId,\n          },\n        },\n      },\n    });\n\n    if (!workspace) {\n      workspace = await prisma.workspace.create({\n        data: {\n          name: `${session.user.name || session.user.email}'s Workspace`,\n          users: {\n            connect: {\n              id: userId,\n            },\n          },\n        },\n      });\n    }\n\n    const newProject = await prisma.project.create({\n      data: {\n        name,\n        description,\n        ownerId: userId,\n        workspaceId: workspace.id,\n      },\n    });\n\n    return NextResponse.json(newProject, { status: 201 });\n  } catch (error) {\n    console.error(\"API_PROJECTS_POST_ERROR\", error);\n    return NextResponse.json(\n      { message: \"Internal Server Error\" },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":";;;;;;AAAA;AACA,8MAAmC,qCAAqC;AACxE,0MAAgD,8BAA8B;;;;AAEvE,eAAe,IAAI,OAAgB;IACxC,IAAI;QACF,MAAM,UAAU,MAAM,IAAA,4HAAI,KAAI,sBAAsB;QAEpD,IAAI,CAAC,WAAW,CAAC,QAAQ,IAAI,EAAE,IAAI;YACjC,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;YAAe,GAAG;gBAAE,QAAQ;YAAI;QACtE;QAEA,8EAA8E;QAC9E,MAAM,SAAS,QAAQ,IAAI,CAAC,EAAE;QAE9B,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,QAAQ,GAAG;QAC5C,MAAM,aAAa,aAAa,GAAG,CAAC,gBAAgB;QAEpD,MAAM,WAAW,MAAM,iIAAM,CAAC,OAAO,CAAC,QAAQ,CAAC;YAC7C,OAAO;gBACL,SAAS;YACX;YACA,QAAQ;gBACN,IAAI;gBACJ,MAAM;gBACN,aAAa;YACf;QACF;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC,UAAU;YAAE,QAAQ;QAAI;IACnD,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,0BAA0B;QACxC,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,SAAS;YAAyB,OAAO,iBAAiB,QAAQ,MAAM,OAAO,GAAG,OAAO;QAAO,GAClG;YAAE,QAAQ;QAAI;IAElB;AACF;AAEO,eAAe,KAAK,OAAgB;IACzC,IAAI;QACF,MAAM,UAAU,MAAM,IAAA,4HAAI,KAAI,sBAAsB;QAEpD,IAAI,CAAC,WAAW,CAAC,QAAQ,IAAI,EAAE,IAAI;YACjC,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;YAAe,GAAG;gBAAE,QAAQ;YAAI;QACtE;QAEA,MAAM,SAAS,QAAQ,IAAI,CAAC,EAAE;QAE9B,yEAAyE;QACzE,MAAM,OAAO,MAAM,iIAAM,CAAC,IAAI,CAAC,UAAU,CAAC;YACxC,OAAO;gBAAE,IAAI;YAAO;QACtB;QAEA,IAAI,CAAC,MAAM;YACT,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,SAAS;YAAwC,GACnD;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,EAAE,IAAI,EAAE,WAAW,EAAE,GAAG,MAAM,QAAQ,IAAI;QAEhD,IAAI,CAAC,MAAM;YACT,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,SAAS;YAA2B,GACtC;gBAAE,QAAQ;YAAI;QAElB;QAEA,yEAAyE;QACzE,gEAAgE;QAChE,IAAI,YAAY,MAAM,iIAAM,CAAC,SAAS,CAAC,SAAS,CAAC;YAC/C,OAAO;gBACL,OAAO;oBACL,MAAM;wBACJ,IAAI;oBACN;gBACF;YACF;QACF;QAEA,IAAI,CAAC,WAAW;YACd,YAAY,MAAM,iIAAM,CAAC,SAAS,CAAC,MAAM,CAAC;gBACxC,MAAM;oBACJ,MAAM,GAAG,QAAQ,IAAI,CAAC,IAAI,IAAI,QAAQ,IAAI,CAAC,KAAK,CAAC,YAAY,CAAC;oBAC9D,OAAO;wBACL,SAAS;4BACP,IAAI;wBACN;oBACF;gBACF;YACF;QACF;QAEA,MAAM,aAAa,MAAM,iIAAM,CAAC,OAAO,CAAC,MAAM,CAAC;YAC7C,MAAM;gBACJ;gBACA;gBACA,SAAS;gBACT,aAAa,UAAU,EAAE;YAC3B;QACF;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC,YAAY;YAAE,QAAQ;QAAI;IACrD,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,2BAA2B;QACzC,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,SAAS;QAAwB,GACnC;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}